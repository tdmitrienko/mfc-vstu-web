{% extends 'base.html.twig' %}

{% block title %}Вход{% endblock %}

{% block body %}
    <div class="d-flex justify-content-center align-items-start">
        <div class="mt-5 card shadow-lg border border-primary-subtle rounded-4" style="max-width: 720px; width: 100%;">
            <div class="card-body p-5">
                <h1 class="h3 mb-4 text-center fw-bold text-primary">Добро пожаловать!</h1>

                {% if error %}
                    <div class="alert alert-danger text-center rounded-3">
                        {{ error.messageKey|trans(error.messageData, 'security') }}
                    </div>
                {% endif %}

                {% if app.user %}
                    <div class="alert alert-info text-center rounded-3">
                        Уже выполнен вход &mdash; <strong>{{ app.user.userIdentifier }}</strong>,
                        <a href="{{ path('app_logout') }}" class="text-decoration-none fw-semibold">Выйти?</a>
                    </div>
                {% endif %}

                <form method="post" class="mt-4">
                    <div class="mb-3">
                        <label for="inputEmail" class="form-label fw-semibold">Email</label>
                        <input
                            type="email"
                            value="{{ last_username }}"
                            name="email"
                            id="inputEmail"
                            class="form-control form-control-lg rounded-3"
                            autocomplete="email"
                            required
                            autofocus
                        >
                    </div>

                    <div class="mb-3 position-relative">
                        <label for="inputPassword" class="form-label fw-semibold">Пароль</label>
                        <div class="input-group has-validation">
                            <input
                                type="password"
                                name="password"
                                id="inputPassword"
                                class="form-control form-control-lg rounded-3 pe-5"
                                autocomplete="current-password"
                                required
                            >
                            <i
                                class="bi bi-eye-slash position-absolute top-50 end-0 translate-middle-y pe-3 text-primary fs-5"
                                id="togglePassword"
                                role="button"
                                style="z-index: 6"
                            ></i>
                        </div>
                    </div>

                    <div class="form-check mb-4">
                        <input class="form-check-input" type="checkbox" name="_remember_me" id="rememberMe">
                        <label class="form-check-label" for="rememberMe">
                            Запомнить меня
                        </label>
                    </div>

                    <button class="btn btn-primary btn-lg w-100 rounded-3 shadow-sm" type="submit">
                        Войти
                    </button>
                </form>
            </div>
        </div>
    </div>
{% endblock %}

{% block body_end %}
    {{ parent() }}
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const passwordInput = document.getElementById('inputPassword');
            const toggleIcon = document.getElementById('togglePassword');

            toggleIcon.addEventListener('click', () => {
                const show = passwordInput.type === 'password';
                passwordInput.type = show ? 'text' : 'password';

                // Меняем иконку
                toggleIcon.classList.toggle('bi-eye-slash', !show);
                toggleIcon.classList.toggle('bi-eye', show);

                // Лёгкая анимация при клике
                toggleIcon.style.transform = 'scale(1.2)';
                setTimeout(() => toggleIcon.style.transform = 'scale(1)', 150);
            });
        });
    </script>
{% endblock %}
